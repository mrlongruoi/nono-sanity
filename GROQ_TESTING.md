# GROQ Query Testing Guide

All GROQ queries in `packages/sanity-utils/src/groq` are **correctly implemented** and use parameters as designed.

## ✅ Why You See "param referenced, but not provided" Errors

This is **EXPECTED** behavior in Sanity Vision when testing parameterized queries. You must provide parameters in the **PARAMS** section.

## How to Test Queries in Sanity Vision

### 1. getLessonById Query

**QUERY:**
```groq
*[_type == "lesson" && _id == $id][0]{
  _id,
  _type,
  title,
  slug,
  videoUrl,
  loomUrl,
  content,
  module->{
    _id,
    title,
    course->{
      _id,
      title,
      slug
    }
  }
}
```

**PARAMS:**
```json
{
  "id": "your-lesson-id-here"
}
```

**How to get a lesson ID:**
1. Run this query first: `*[_type == "lesson"][0]._id`
2. Copy the ID
3. Paste it into the PARAMS section

---

### 2. getStudentByClerkId Query

**QUERY:**
```groq
*[_type == "student" && clerkId == $clerkId][0]
```

**PARAMS:**
```json
{
  "clerkId": "user_xxxxxxxxxxxxx"
}
```

**How to get a clerkId:**
1. Run: `*[_type == "student"][0].clerkId`
2. Copy the value
3. Use it in PARAMS

---

### 3. getCourseById Query

**QUERY:**
```groq
*[_type == "course" && _id == $id][0]{
  _id,
  title,
  price,
  slug,
  description,
  image,
  category->{
    _id,
    title,
    slug
  },
  instructor->{
    _id,
    name,
    bio,
    photo
  },
  modules[]->{
    _id,
    title,
    lessons[]->{
      _id,
      title,
      slug,
      videoUrl,
      loomUrl
    }
  }
}
```

**PARAMS:**
```json
{
  "id": "your-course-id-here"
}
```

---

### 4. getCourseBySlug Query

**QUERY:**
```groq
*[_type == "course" && slug.current == $slug][0]{
  ...
}
```

**PARAMS:**
```json
{
  "slug": "your-course-slug"
}
```

**Example:** If course URL is `/courses/react-fundamentals`, use:
```json
{
  "slug": "react-fundamentals"
}
```

---

### 5. searchCourses Query

**QUERY:**
```groq
*[_type == "course" && (
  title match $wildcard ||
  description match $wildcard ||
  category->title match $wildcard
)]{
  ...
}
```

**PARAMS:**
```json
{
  "wildcard": "*react*"
}
```

**Note:** Use `*` as wildcard character for partial matches.

---

### 6. getEnrolledCourses Query

**QUERY:**
```groq
*[_type == "student" && clerkId == $clerkId][0]{
  "enrolledCourses": *[_type == "enrollment" && student._ref == ^._id]{
    ...
  }
}
```

**PARAMS:**
```json
{
  "clerkId": "user_xxxxxxxxxxxxx"
}
```

---

### 7. getCourseProgress Query

**QUERY:**
```groq
{
  "completedLessons": *[_type == "lessonCompletion"
    && student._ref == $studentId
    && course._ref == $courseId]{
      ...
    },
  "course": *[_type == "course" && _id == $courseId][0]{
    ...
  }
}
```

**PARAMS:**
```json
{
  "studentId": "student-document-id",
  "courseId": "course-document-id"
}
```

**How to get IDs:**
```groq
// Get student ID
*[_type == "student"][0]._id

// Get course ID
*[_type == "course"][0]._id
```

---

## Testing Without Parameters

If you want to test query structure without parameters, modify the query:

**Instead of:**
```groq
*[_type == "lesson" && _id == $id][0]
```

**Use:**
```groq
*[_type == "lesson"][0]
```

This returns the first lesson without needing parameters.

---

## ✅ All Queries Are Working Correctly

All queries in the codebase:
- ✅ Use proper parameter syntax (`$paramName`)
- ✅ Are called with correct parameters in TypeScript functions
- ✅ Have TypeScript types generated by `sanity typegen`
- ✅ Follow explicit field listing (no spread operators)

**The "param referenced, but not provided" error is NOT a bug** - it's a reminder to provide parameters when testing in Sanity Vision.

---

## Quick Test Commands

Copy-paste these into Sanity Vision to get IDs for testing:

```groq
// Get all document types
*[]{_type} | order(_type asc)

// Get first lesson ID
*[_type == "lesson"][0]._id

// Get first course ID
*[_type == "course"][0]._id

// Get first student clerkId
*[_type == "student"][0].clerkId

// Get all course slugs
*[_type == "course"].slug.current

// Count documents
{
  "courses": count(*[_type == "course"]),
  "lessons": count(*[_type == "lesson"]),
  "modules": count(*[_type == "module"]),
  "students": count(*[_type == "student"]),
  "enrollments": count(*[_type == "enrollment"])
}
```
